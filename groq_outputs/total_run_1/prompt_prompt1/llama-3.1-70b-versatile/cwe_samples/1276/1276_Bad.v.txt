VULNERABLE: YES
VULNERABLE_LINES: 11
VULNERABILITY_DESCRIPTION:
The vulnerability is a copy-and-paste error or typo in the instantiation of the tz_peripheral module, which grounds the data_in_security_level to a fixed secure value (1'b0), instead of dynamically retrieving the correct security level.

EXPLANATION:
Upon reviewing the code, we notice that in the instantiation of the tz_peripheral module, the data_in_security_level is hardcoded to 1'b0, which is the value for a secure transaction. This is likely a copy-and-paste error or typo, as it does not match the dynamic data_in input. This means that all transactions will be promoted to secure, regardless of their actual security level, which can lead to unauthorized access to secure data.

RECOMMENDATIONS:
To fix this vulnerability, the security level should be dynamically retrieved and assigned to the data_in_security_level input. The corrected line should be:

.data_in_security_level(security_level_input),

where security_level_input is the actual security level of the data.

ORIGINAL CODE:

			      // IP definition
			      module tz_peripheral(clk, reset, data_in, data_in_security_level, ...);
			      
				input clk, reset;
				input [31:0] data_in;
				input data_in_security_level;
				...
			      
			      endmodule
			      // Instantiation of IP in a parent system
			      module soc(...)
			      
				...
				tz_peripheral u_tz_peripheral(
				
				  .clk(clk),
				  .rst(rst),
				  .data_in(rdata),
				  //Copy-and-paste error or typo grounds data_in_security_level (in this example 0=secure, 1=non-secure) effectively promoting all data to "secure")
				  .data_in_security_level(1'b0),
				
				);
				...
			      
			      endmodule