 

VULNERABLE: YES
VULNERABLE_LINES: 34
VULNERABILITY_DESCRIPTION: The code is vulnerable to a race condition between the time when the vmalloc mapping code updates the PMD to the point in time where it synchronizes this update with the other page-tables in the system.
EXPLANATION: The code snippet contains a function called vmalloc_fault() which is responsible for handling faults on the vmalloc or module mapping area. The function uses a pointer pmd_k to access the PMD (Page Map Directory) and updates it. However, there is a race condition between the time when the vmalloc mapping code updates the PMD and the time when it synchronizes this update with the other page-tables in the system. This can cause another thread/CPU to map an area on the same PMD, find it already present, and not synchronize it with the rest of the system yet. As a result, v[mz]alloc might return areas which are not mapped in every page-table in the system, causing an unhandled page-fault when they are accessed.
RECOMMENDATIONS: To fix this vulnerability, the code should be modified to ensure that the PMD is synchronized with the other page-tables in