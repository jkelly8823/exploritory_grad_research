 

VULNERABLE: YES
VULNERABLE_LINES: 10
VULNERABILITY_DESCRIPTION: A race condition exists in the flush_tlb_all function. The function first checks if a broadcast is needed, and if so, it calls on_each_cpu to execute ipi_flush_tlb_all on each CPU. However, the function then calls local_flush_tlb_kernel_range without waiting for the broadcast to complete. This can lead to a race condition where the local_flush_tlb_kernel_range function is executed before the ipi_flush_tlb_all function has completed its broadcast.
EXPLANATION: The issue arises because the on_each_cpu function is asynchronous, meaning that it does not block until the function has completed execution on all CPUs. As a result, the local_flush_tlb_kernel_range function can be executed before the ipi_flush_tlb_all function has completed its broadcast, leading to a potential race condition.
RECOMMENDATIONS: To fix this issue, the local_flush_tlb_kernel_range function should be called after the on_each_cpu function has completed its broadcast. This can be achieved by using the on_each_cpu function with the IPI_FLUSH_TLB_ALL flag set to 1, which will block until the function has completed execution on all CPUs.