 


VULNERABLE: YES
VULNERABLE_LINES: 1-3, 6-7, 10-11
VULNERABILITY_DESCRIPTION: This code snippet contains a vulnerability related to the handling of directory access control. The issue arises from the fact that the code does not properly check for the CAP_DAC_READ_SEARCH capability when the MAY_WRITE mask is not set. This can lead to unintended access to directories.
EXPLANATION: The code checks for the CAP_DAC_READ_SEARCH capability when the MAY_WRITE mask is not set, but it does not do so when the MAY_WRITE mask is set. This is problematic because it allows an attacker to bypass the DAC_READ_SEARCH check and gain access to directories they should not have access to. Additionally, the code does not properly handle the case where the inode_capable function returns an error.
RECOMMENDATIONS: To fix this vulnerability, the code should be modified to check for the CAP_DAC_READ_SEARCH capability regardless of the MAY_WRITE mask. This can be achieved by adding an additional check for the CAP_DAC_READ_SEARCH capability before the MAY_WRITE mask check. The code should also be modified to properly handle the case where the inode_capable function returns an error. This can be done by checking the return value