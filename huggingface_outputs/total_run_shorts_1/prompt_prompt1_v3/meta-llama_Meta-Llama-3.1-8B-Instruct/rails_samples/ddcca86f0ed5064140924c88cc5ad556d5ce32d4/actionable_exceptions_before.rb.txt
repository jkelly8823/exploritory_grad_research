 

VULNERABLE: YES
VULNERABLE_LINES: 13
VULNERABILITY_DESCRIPTION: The code is vulnerable to a Cross-Site Scripting (XSS) attack. The `ERB::Util.unwrapped_html_escape(location)` function is not sufficient to prevent XSS attacks, as it does not escape all possible HTML characters.
EXPLANATION: The `ERB::Util.unwrapped_html_escape(location)` function only escapes a limited set of HTML characters, leaving other characters such as `<`, `>`, and `&` unescaped. This allows an attacker to inject malicious HTML code into the redirect response, potentially leading to XSS attacks.
RECOMMENDATIONS: To fix this vulnerability, use a more robust HTML escaping function, such as `ERB::Util.html_escape(location)`, which escapes all possible HTML characters. Additionally, consider using a library like `sanitize` to further sanitize the redirect location. ```ruby ERB::Util.html_escape(location) ``` ```ruby require'sanitize'; Sanitize.fragment(location) ``` ```ruby require'sanitize'; Sanitize.fragment(location, elements: %w[a b img]) ``` ```ruby require'sanitize'; Sanitize.fragment(location, attributes: %w[href src]) ``` ```ruby require'sanitize';