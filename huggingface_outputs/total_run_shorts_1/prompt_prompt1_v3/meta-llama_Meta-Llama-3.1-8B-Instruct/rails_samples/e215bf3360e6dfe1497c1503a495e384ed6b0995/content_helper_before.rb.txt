 

VULNERABLE: YES
VULNERABLE_LINES: 3
VULNERABILITY_DESCRIPTION: The code is vulnerable to a DOM-based XSS attack due to the use of `sanitize` method which does not properly sanitize user input. An attacker could inject malicious HTML code that would be executed by the browser when the content is rendered.
EXPLANATION: The `sanitize` method is used to sanitize user input, but it does not properly sanitize HTML tags. An attacker could inject malicious HTML code, such as a script tag, that would be executed by the browser when the content is rendered. This could lead to a DOM-based XSS attack.
RECOMMENDATIONS: To fix this vulnerability, use a more robust sanitization library, such as `DOMPurify`, which properly sanitizes HTML tags and prevents XSS attacks. Additionally, consider using a Content Security Policy (CSP) to define which sources of content are allowed to be executed. This would prevent an attacker from injecting malicious code, even if the sanitization library is bypassed.  ```ruby
      sanitize_action_text_content(render_action_text_attachments(content))
    end

    def sanitize_action_text_content(content)
      DOMPurify.sanitize(
        content.to_html,
        allowedTags: