 

VULNERABLE: YES
VULNERABLE_LINES: 6-8
EXPLANATION:
The code is vulnerable to the CVE-2016-7097 vulnerability because it preserves the setgid bit during a setxattr call. This allows local users to gain group privileges by leveraging the existence of a setgid program with restrictions on execute permissions. The vulnerability is present in the lines where the mode is updated and set using xfs_set_mode.
RECOMMENDATIONS:
1.  Update the mode to not preserve the setgid bit.
2.  Use a secure method to update the mode, such as using the xfs_set_acl function which does not preserve the setgid bit.
3.  Implement additional checks to ensure that the setgid bit is not preserved during a setxattr call.  This can be done by checking the current mode and the updated mode to ensure that the setgid bit is not preserved.  If it is, then an error should be returned.  This can be done by adding a check after the xfs_set_mode call to ensure that the setgid bit is not preserved.  If it is, then an error should be returned.  This can be done by adding a check after the xfs_set