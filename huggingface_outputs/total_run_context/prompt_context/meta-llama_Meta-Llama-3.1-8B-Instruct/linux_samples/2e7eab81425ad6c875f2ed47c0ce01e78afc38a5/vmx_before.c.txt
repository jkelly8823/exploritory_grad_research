 

VULNERABLE: YES
VULNERABLE_LINES: 3
EXPLANATION:
The code sample provided is vulnerable to the Spectre v2 attack due to the lack of indirect branch prediction barrier (IBPB) when switching the active VMCS within a guest. This allows an attacker at L2 to execute code on an indirect branch on the host machine. The code relies on the L1 VMM to protect itself with retpolines, IBPB or IBRS, but this is not sufficient to prevent the attack.
RECOMMENDATIONS:
Upgrade to Kernel 6.2 or past commit 2e7eab81425a to fix the vulnerability. Alternatively, add an IBPB instruction after switching the active VMCS to prevent the attack. 

VULNERABILITY LIST:
CVE_ID:CVE-2022-2196
CVE Description:
A regression exists in the Linux Kernel within KVM: nVMX that allowed for speculative execution attacks. L2 can carry out Spectre v2 attacks on L1 due to L1 thinking it doesn't need retpolines or IBPB after running L2 due to KVM (L0) advertising eIBRS support to L1. An attacker at L2 with